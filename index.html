<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello Kitty Cafe World</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Nunito:wght@700;800&display=swap');

:root {
    /* --- PASTEL FLAT PALETTE --- */
    --bg-color: #fce6ed;        /* –ü–æ—á—Ç–∏ –±–µ–ª—ã–π —Å —Ä–æ–∑–æ–≤—ã–º –æ—Ç—Ç–µ–Ω–∫–æ–º */
    --dot-color: #f8bfd2;       /* –ï–¥–≤–∞ –∑–∞–º–µ—Ç–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫ */
    
    --card-bg: #fff6f6;
    --border-color: #e5cfe1;    /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª–∞—è –æ–±–≤–æ–¥–∫–∞ */
    
    --pink-pastel: #FFB7D5;
    --blue-pastel: #BAE1FF;
    --yellow-pastel: #2c2a21;
    
    --text-main: #8E7C85;       /* –ú—è–≥–∫–∏–π —Å–µ—Ä–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
    --text-light: #B4A5AC;
}

/* ===== BASE ===== */
body {
    margin: 0;
    font-family: 'Quicksand', sans-serif;
    color: var(--text-main);
    background-color: var(--bg-color);
    overflow-x: hidden;

    /* –ú–ï–õ–ö–ò–ô –†–ï–î–ö–ò–ô –ì–û–†–û–®–ï–ö */
    background-image: radial-gradient(var(--dot-color) 3px, transparent 3px);
    background-size: 80px 80px; /* –û—á–µ–Ω—å —Ä–µ–¥–∫–∏–π —à–∞–≥ (80px) */
    background-position: 0 0;
}

/* ===== –û–ë–©–ò–ï –°–¢–ò–õ–ò –ö–û–ù–¢–ï–ô–ù–ï–†–û–í (FLAT) ===== */
.nav-bar, 
.profile-header, 
.market-item, 
.gacha-card, 
.info-card,
.start-btn,
.promo-input {
    background: var(--card-bg);
    border: 2px solid var(--border-color);
    border-radius: 20px;
    /* –ü–ª–æ—Å–∫–∞—è —Ç–µ–Ω—å (–±–µ–∑ —Ä–∞–∑–º—ã—Ç–∏—è) */
    box-shadow: 0 4px 0 #F0F0F0;
}

/* ===== BUTTONS ===== */
button {
    border: none;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    transition: transform 0.1s;
}

button:active {
    transform: translateY(2px);
    box-shadow: none !important; /* –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Ç–µ–Ω—å –ø—Ä–æ–ø–∞–¥–∞–µ—Ç (—ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è) */
}

/* –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
.start-btn, .btn-claim, .connect-mm, #donate-button {
    background-color: var(--pink-pastel);
    color: white;
    border: none;
    box-shadow: 0 4px 0 #FF9ECA; /* –ü–ª–æ—Å–∫–∞—è —Ç–µ–Ω—å —Ç–µ–º–Ω–µ–µ —Ü–≤–µ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
}

/* –í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
.buy-btn, .promo-btn {
    background-color: var(--blue-pastel);
    color: white;
    border-radius: 12px;
    box-shadow: 0 3px 0 #90CAF9;
}

.skip-btn {
    background: white;
    color: var(--text-main);
    border: 2px solid var(--border-color);
    box-shadow: 0 3px 0 #E0E0E0;
}

/* ===== START SCREEN ===== */
#start-screen {
    position: fixed;
    inset: 0;
    background-color: var(--bg-color);
    background-image: radial-gradient(var(--dot-color) 2px, transparent 2px);
    background-size: 60px 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.start-btn {
    margin-top: 20px;
    padding: 16px 50px;
    font-size: 22px;
    border-radius: 50px;
}

h1 {
    font-family: 'Nunito', sans-serif;
    color: var(--pink-pastel);
    font-size: 30px;
    font-weight: 800;
    margin-bottom: 5px;
}

/* ===== NAV BAR ===== */
.nav-bar {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 30px;
    border-radius: 50px;
    display: flex;
    gap: 30px;
    z-index: 100;
    /* –£–±–∏—Ä–∞–µ–º —Ä–∞–º–∫—É —É –Ω–∞–≤–±–∞—Ä–∞, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–Ω—å, —á—Ç–æ–±—ã –±—ã–ª–æ —á–∏—â–µ */
    border: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.nav-item {
    font-size: 26px;
    cursor: pointer;
    opacity: 0.5;
    transition: 0.2s;
}

.nav-item.active {
    opacity: 1;
    transform: translateY(-2px);
}

/* ===== PAGES ===== */
.page {
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    padding-bottom: 100px;
    max-width: 600px;
    width: 100%;
    margin: 0 auto;
    box-sizing: border-box;
}

.page.active {
    display: flex;
    animation: fadeIn 0.3s ease-out;
}

/* ===== GACHA (FIXED: 3 COLUMNS) ===== */
.gacha-container {
    display: grid;
    /* –†–æ–≤–Ω–æ 3 –∫–æ–ª–æ–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —à–∏—Ä–∏–Ω—ã */
    grid-template-columns: repeat(3, 1fr); 
    gap: 12px;
    width: 100%;
    margin-top: 20px;
}

.gacha-card {
    /* –£–±–∏—Ä–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —à–∏—Ä–∏–Ω—É, —á—Ç–æ–±—ã –≤–ª–µ–∑–ª–æ –≤ —Å–µ—Ç–∫—É */
    width: auto; 
    padding: 15px 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.1s;
}

.gacha-card:hover {
    transform: translateY(-3px);
}

.gacha-card h3 {
    font-size: 14px;
    margin: 5px 0;
}

/* –≠–º–æ–¥–∑–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.gacha-card div:first-child {
    font-size: 40px !important; /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º —ç–º–æ–¥–∑–∏ –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
}

.price-tag {
    background: var(--bg-color);
    color: var(--text-main);
    padding: 4px 10px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 12px;
    margin-top: 5px;
    border: 1px solid var(--border-color);
}

/* ===== MARKET ===== */
.market-list {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.market-item {
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* ===== PROFILE ===== */
.profile-header {
    width: 100%;
    padding: 20px;
    box-sizing: border-box;
    text-align: center;
}

.promo-input {
    border: 2px solid var(--border-color);
    background: #FFFEFD;
    padding: 10px;
    outline: none;
    color: var(--text-main);
    box-shadow: inset 0 2px 0 #F0F0F0; /* –í–¥–∞–≤–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
    width: 100px;
    text-align: center;
}

/* ===== REWARD OVERLAY ===== */
#reward-overlay {
    position: fixed;
    inset: 0;
    display: none;
    background: rgba(255, 255, 255, 0.95);
    z-index: 600;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.drop-box {
    width: 220px;
    height: 220px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(circle, #FFF0F5 0%, transparent 60%);
    margin-bottom: 20px;
}

.info-card {
    padding: 20px 40px;
    text-align: center;
    border: 2px solid var(--pink-pastel);
    box-shadow: 0 4px 0 var(--pink-pastel);
}

.btn-claim {
    margin-top: 25px;
    padding: 12px 40px;
    border-radius: 30px;
    font-size: 18px;
}

/* ===== VIDEO ===== */
#video-layer {
    position: fixed;
    inset: 0;
    background: #FFF;
    display: none;
    z-index: 500;
    justify-content: center;
    align-items: center;
}
video {
    width: 100%;
    max-width: 450px;
    border-radius: 20px;
}
.skip-btn {
    position: absolute;
    top: 20px; right: 20px;
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 700;
}
#cafes-row {
    display: flex;
    gap: 12px;
    margin-top: 30px;
    justify-content: space-between; /* —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ */
}

.donate-card {
    flex: 1; /* –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–≤–Ω–æ–π —à–∏—Ä–∏–Ω—ã */
    min-width: 0;
    background: var(--card-bg);
    border: 2px solid var(--border-color);
    border-radius: 20px;
    box-shadow: 0 4px 0 #F0F0F0;
    padding: 12px 15px;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s, border-color 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.donate-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 0 #F0F0F0;
}

.donate-card.selected {
    border-color: var(--pink-pastel);
    box-shadow: 0 6px 0 var(--pink-pastel);
}

.donate-card h2 {
    margin:0 0 5px 0;
    color: var(--pink-pastel);
    font-size:18px;
    font-weight:800;
}

.progress-bar {
    width: 100%;
    height: 10px;
    background: #F0F0F0;
    border-radius: 8px;
    overflow: hidden;
    margin:5px 0;
}

.progress-fill {
    height: 100%;
    background: var(--pink-pastel);
    width: 0%;
    transition: width 0.3s;
}

.donate-card p {
    font-size: 14px;
    margin: 2px 0;
    text-align: center;
}


/* ===== INVENTORY ===== */
#inventory {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
}
</style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div id="start-screen" onclick="startGame()">
        <h1>üéÄ Hello Kitty World üéÄ</h1>
        <button class="start-btn">TAP TO START üéµ</button>
    </div>

    <div id="video-layer">
        <button class="skip-btn" onclick="skipVideo()">SKIP >></button>
        <video id="gacha-video" playsinline></video>
    </div>

    <div id="reward-overlay">
        <div class="reward-title">‚ú® YOU GOT IT! ‚ú®</div>
        <div class="drop-box">
            <div class="glow-aura" id="glow-fx"></div>
            <img id="reward-img" src="" class="drop-img">
        </div>
        <div class="info-card">
            <h2 id="reward-name" style="margin: 0; color: var(--primary);">Name</h2>
            <p id="reward-rarity" style="margin: 5px 0 0 0; color: #888; font-weight: bold;">RARITY</p>
        </div>
        <button class="btn-claim" onclick="claimReward()">KEEP IT! üíñ</button>
    </div>

    <div id="main-ui" style="display: none;">
        <nav class="nav-bar">
            <div class="nav-item active" onclick="setPage('gacha')">üé∞</div>
            <div class="nav-item" onclick="setPage('market')">üè™</div>
            <div class="nav-item" onclick="setPage('donate')">üíñ</div>
            <div class="nav-item" onclick="setPage('profile')">üë§</div>
        </nav>

        <div id="page-gacha" class="page active">
            <h1>Choose a Treat!</h1>
            <div style="background: white; padding: 10px 30px; border-radius: 30px; margin-bottom: 20px; box-shadow: 0 5px 10px rgba(0,0,0,0.05);">
                <span style="color: var(--primary); font-weight: bold; font-size: 20px;">ü™ô <span id="ui-tokens">0</span> Tokens</span>
            </div>

            <div class="gacha-container">
                <div class="gacha-card" onclick="spin('icecream', 25)">
                    <div style="font-size: 60px;">üç¶</div>
                    <h3>Ice Cream</h3>
                    <div class="price-tag">25 TKN</div>
                </div>
                <div class="gacha-card" onclick="spin('milkshake', 50)">
                    <div style="font-size: 60px;">ü•§</div>
                    <h3>Milkshake</h3>
                    <div class="price-tag">50 TKN</div>
                </div>
                <div class="gacha-card" onclick="spin('cake', 100)">
                    <div style="font-size: 60px;">üéÇ</div>
                    <h3>Cake</h3>
                    <div class="price-tag">100 TKN</div>
                </div>
            </div>
        </div>

        <div id="page-market" class="page">
            <h1>üè™ Market</h1>
            <p>Scroll to see offers from others!</p>
            <div id="market-container" class="market-list"></div>
        </div>
<div id="page-donate" class="page">
    <h1>Support Cafes ‚òï</h1>

    <div style="margin-top:10px; font-size:16px; color: var(--text-main);">
        üíñ 1 ETH = 1000 Tokens
    </div>

    <div style="margin-top:15px;">
        <input type="number" id="donate-input" class="promo-input" placeholder="0.1 ETH" style="width:150px; font-size:18px;">
        <button class="connect-mm" style="margin-left:10px;" onclick="donate()">DONATE</button>
    </div>

    <div id="cafes-row" style="display:flex; gap:12px; margin-top:30px; justify-content: space-between;">
        <div class="donate-card" data-index="0" onclick="selectCafe(0)">
            <h2>Kitty Cafe</h2>
            <p>Goal: 10 ETH | Collected: <span class="collected">0</span> ETH</p>
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
            <p>Reward: <span class="multiplier">1.23√ó</span></p>
        </div>

        <div class="donate-card" data-index="1" onclick="selectCafe(1)">
            <h2>Hello Cafe</h2>
            <p>Goal: 8 ETH | Collected: <span class="collected">0</span> ETH</p>
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
            <p>Reward: <span class="multiplier">1.84√ó</span></p>
        </div>

        <div class="donate-card" data-index="2" onclick="selectCafe(2)">
            <h2>Rainbow Cafe</h2>
            <p>Goal: 5 ETH | Collected: <span class="collected">0</span> ETH</p>
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
            <p>Reward: <span class="multiplier">2.17√ó</span></p>
        </div>
    </div>
</div>


        <div id="page-profile" class="page">
            <h1>My Profile üë§</h1>
            <div class="profile-header">
                <button class="connect-mm" onclick="connectWallet()">ü¶ä Connect MetaMask</button>
                <p id="wallet-address" style="font-size: 12px; display: none;">0x...</p>
                <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                    <div><b>ETH:</b> <span id="ui-eth">0.00</span></div>
                    <div><b>TKN:</b> <span id="ui-tokens-p">0</span></div>
                </div>
                <div class="promo-area">
                    <p style="font-size: 12px; margin-bottom: 5px;">Secret Code:</p>
                    <div class="promo-container">
                        <input type="text" id="promo-code" class="promo-input" placeholder="Enter code">
                        <button class="promo-btn" onclick="applyPromo()">APPLY</button>
                    </div>
                    <div id="promo-status" class="promo-status">‚ú® Code Activated! ‚ú®</div>
                </div>
            </div>
            <h3>My Inventory</h3>
            <div id="inventory" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"></div>
        </div>
    </div>

    <script>
        const TOKEN_ADDRESS = "0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0"; 
        const NFT_ADDRESS = "0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82"; 
        const CF_ADDRESS = "0x9A676e781A523b5d0C0e43731313A708CB607508";

        const TOKEN_ABI = ["function balanceOf(address) view returns (uint256)", "function decimals() view returns (uint8)", "function burn(uint256 amount) external"];
        const CF_ABI = ["function contribute(uint256 _id) public payable", "function campaignCount() public view returns (uint256)", "function createCampaign(string,uint256,uint256) public"];
        const NFT_ABI = ["function mintItem(address player, string memory tokenURI) public returns (uint256)"];

        let provider, signer, tokenContract, cfContract, nftContract;
        let userAddress = "";
        let tokens = 0;
        let eth = 0;
        let currentReward = null;
        let promoActive = null;
        let inventory = []; // –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—É—Å—Ç–æ–π

        const rarities = {
            common: { color: "#a0aec0", name: "Common" },
            rare: { color: "#63b3ed", name: "Rare" },
            epic: { color: "#9f7aea", name: "Epic" },
            legendary: { color: "#f6e05e", name: "Legendary" },
            mythic: { color: "#f56565", name: "MYTHIC" }
        };

        const gachaConfig = {
            icecream: { video: "icecream_spin.mp4", prefix: "icecream" },
            milkshake: { video: "milkshake_spin.mp4", prefix: "milkshake" },
            cake: { video: "cake_spin.mp4", prefix: "cake" }
        };

        const music = document.getElementById('bg-music');
        music.volume = 0.4;

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            music.play();
            // –ù–∞ —Å—Ç–∞—Ä—Ç–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏–º, –ø–æ–∫–∞ –Ω–µ—Ç –∫–æ–Ω–Ω–µ–∫—Ç–∞
        }

        function setPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            
            const map = ['gacha', 'market', 'donate', 'profile'];
            const index = map.indexOf(id);
            if(index !== -1) document.querySelectorAll('.nav-item')[index].classList.add('active');

            // –ï—Å–ª–∏ –∑–∞—à–ª–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤–µ—â–µ–π
            if(id === 'profile') renderInventory();
        }
        
        async function connectWallet() {
            if (window.ethereum) {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();
                    
                    tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
                    cfContract = new ethers.Contract(CF_ADDRESS, CF_ABI, signer);
                    nftContract = new ethers.Contract(NFT_ADDRESS, NFT_ABI, signer);

                    // –û–±–Ω–æ–≤–ª—è–µ–º UI —Ç–æ–ª—å–∫–æ –¥–ª—è –ü–†–û–§–ò–õ–Ø
                    document.getElementById('wallet-address').innerText = userAddress.substring(0,6) + "..." + userAddress.substring(38);
                    document.getElementById('wallet-address').style.display = 'block';
                    document.querySelector('#page-profile .connect-mm').innerText = "Connected ‚úÖ";

                    await updateBalances();
                    await checkAndCreateInitialCampaign();

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–µ—â–∏ –∏–∑ –ø–∞–º—è—Ç–∏ –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
                    const savedInv = localStorage.getItem('kitty_inv_' + userAddress.toLowerCase());
                    inventory = savedInv ? JSON.parse(savedInv) : [];
                    renderInventory();

                } catch (e) { console.error(e); alert("Connect error!"); }
            } else { alert("Install MetaMask!"); }
        }

        async function updateBalances() {
            if (!userAddress || !tokenContract) return;
            try {
                const b = await provider.getBalance(userAddress);
                eth = ethers.utils.formatEther(b);
                document.getElementById('ui-eth').innerText = parseFloat(eth).toFixed(2);
                
                const tb = await tokenContract.balanceOf(userAddress);
                tokens = Math.floor(parseFloat(ethers.utils.formatUnits(tb, 18)));
                document.querySelectorAll('#ui-tokens, #ui-tokens-p').forEach(el => el.innerText = tokens);
            } catch(e) { console.error(e); }
        }
const cafes = [
    { name: "Kitty Cafe", goal: 10, collected: 0, multiplier: 1.23 },
    { name: "Hello Cafe", goal: 8, collected: 0, multiplier: 1.84 },
    { name: "Rainbow Cafe", goal: 5, collected: 0, multiplier: 2.17 }
];

let selectedCafe = 0;

function selectCafe(index) {
    selectedCafe = index;
    document.querySelectorAll('.donate-card').forEach((card,i)=>{
        if(i === index) card.classList.add('selected');
        else card.classList.remove('selected');
    });
}

async function donate() {
    if (!cfContract || !userAddress) return alert("Connect Wallet first!");
    const val = parseFloat(document.getElementById('donate-input').value);
    if (!val || val <= 0) return alert("Enter amount!");

    const cafe = cafes[selectedCafe];

    try {
        const tx = await cfContract.contribute(selectedCafe, { value: ethers.utils.parseEther(val.toString()) });
        alert(`Wait for confirmation... Donating to ${cafe.name}`);
        await tx.wait();

        const tokensReceived = Math.floor(val * 1000 * cafe.multiplier);
        alert(`You received ${tokensReceived} Tokens for donating to ${cafe.name}! üíñ`);

        cafe.collected += val;
        renderCafeProgress();

        await updateBalances();

    } catch (e) { console.error(e); alert("Donation failed!"); }
}

function renderCafeProgress() {
    document.querySelectorAll('.donate-card').forEach((card,i)=>{
        const cafe = cafes[i];
        card.querySelector('.collected').innerText = cafe.collected.toFixed(2);
        const percent = Math.min((cafe.collected/cafe.goal)*100, 100);
        card.querySelector('.progress-fill').style.width = percent+'%';
        card.querySelector('.multiplier').innerText = cafe.multiplier.toFixed(2)+'√ó';
    });
}

selectCafe(0);
renderCafeProgress();


        async function checkAndCreateInitialCampaign() {
            try {
                const count = await cfContract.campaignCount();
                if (count == 0) {
                    const tx = await cfContract.createCampaign("Kitty Cafe", ethers.utils.parseEther("100"), 30);
                    await tx.wait();
                }
            } catch (e) { console.log("Campaign exists"); }
        }

        function applyPromo() {
            const val = document.getElementById('promo-code').value.toUpperCase().trim();
            if (val === 'MIF' || val === 'LEG') {
                promoActive = val;
                document.getElementById('promo-status').innerText = `‚ú® ${val} ACTIVE ‚ú®`;
                document.getElementById('promo-status').style.display = 'block';
                document.getElementById('promo-status').style.color = 'green';
            } else { alert("Wrong code!"); }
        }

        async function spin(type, cost) {
            if (!tokenContract || !userAddress) return alert("Connect Wallet in Profile first!");
            if (tokens < cost) return alert("Not enough tokens! Donate ETH.");

            try {
                // –°–ø–∏—Å—ã–≤–∞–µ–º –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
                const amountToBurn = ethers.utils.parseUnits(cost.toString(), 18);
                const tx = await tokenContract.burn(amountToBurn);
                await tx.wait(); 
                await updateBalances();

                // –õ–æ–≥–∏–∫–∞ —à–∞–Ω—Å–æ–≤
                let rKey = 'common';
                const rand = Math.random() * 100;
                if (promoActive === 'MIF') rKey = 'mythic';
                else if (promoActive === 'LEG') rKey = 'legendary';
                else {
                    if(rand > 60) rKey = 'rare';
                    if(rand > 85) rKey = 'epic';
                    if(rand > 98) rKey = 'legendary';
                    if(rand > 99.5) rKey = 'mythic';
                }
                promoActive = null; 
                document.getElementById('promo-status').style.display = 'none';

                currentReward = { type: type, name: type.toUpperCase(), rarity: rKey, image: `${type}_${rKey}.png` };

                // –í–∏–¥–µ–æ
                document.getElementById('main-ui').style.display = 'none';
                const vl = document.getElementById('video-layer');
                const v = document.getElementById('gacha-video');
                vl.style.display = 'block';
                v.src = `${type}_spin.mp4`;
                v.play();
                v.onended = showReward;

            } catch (e) { alert("Transaction failed."); }
        }

        function skipVideo() {
            const v = document.getElementById('gacha-video');
            v.pause();
            showReward();
        }

        function showReward() {
            const overlay = document.getElementById('reward-overlay');
            const rData = rarities[currentReward.rarity];
            document.getElementById('reward-name').innerText = currentReward.name;
            document.getElementById('reward-rarity').innerText = rData.name;
            document.getElementById('reward-rarity').style.color = rData.color;
            document.getElementById('reward-img').src = currentReward.image;
            document.getElementById('glow-fx').style.background = `radial-gradient(circle, ${rData.color} 0%, transparent 70%)`;
            overlay.style.display = 'flex';
            setTimeout(() => overlay.classList.add('show'), 10);
        }

        async function claimReward() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∏–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —é–∑–µ—Ä–∞
            inventory.push(currentReward);
            if(userAddress) {
                localStorage.setItem('kitty_inv_' + userAddress.toLowerCase(), JSON.stringify(inventory));
            }

            // –ú–∏–Ω—Ç–∏–º NFT –≤ –±–ª–æ–∫—á–µ–π–Ω
            if (nftContract && userAddress) {
                try {
                    const tx = await nftContract.mintItem(userAddress, currentReward.image);
                    console.log("NFT Minting...");
                } catch (e) { console.warn("NFT Mint failed"); }
            }

            renderInventory();
            document.getElementById('reward-overlay').classList.remove('show');
            setTimeout(() => {
                document.getElementById('reward-overlay').style.display = 'none';
                document.getElementById('video-layer').style.display = 'none';
                document.getElementById('main-ui').style.display = 'block';
                music.volume = 0.4;
            }, 300);
        }

        function renderInventory() {
            const box = document.getElementById('inventory');
            if(!box) return;
            box.innerHTML = "";
            
            if(!userAddress) {
                box.innerHTML = "<p>Connect wallet to see your collection üéÄ</p>";
                return;
            }

            inventory.forEach(item => {
                const color = rarities[item.rarity]?.color || "#ccc";
                box.innerHTML += `
                    <div style="width:70px; height:70px; border:3px solid ${color}; border-radius:15px; background:white; position:relative; display:flex; align-items:center; justify-content:center; margin:5px;">
                        <img src="${item.image}" style="width:50px; height:50px; object-fit:contain;">
                        <div style="position:absolute; bottom:-5px; font-size:8px; background:${color}; color:white; padding:2px 5px; border-radius:10px;">${item.rarity}</div>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>